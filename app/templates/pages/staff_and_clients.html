{% extends "layout.html" %}

{% block title %}Staff and clients{% endblock %}

{% block content %}
<div class="flex flex-col" x-data="{ activeTab: '{{active_tab}}' }">
    
    <div class="flex flex-col w-full pt-5 pb-8 items-center justify-center">
        <div class="fixed inset-x-6 top-[-5rem] -z-10 transform-gpu overflow-hidden blur-3xl " aria-hidden="true">
        <div class="relative left-1/6 -z-10 aspect-[1155/678] w-[36.125rem] max-w-none -translate-x-1/2 rotate-[30deg] bg-gradient-to-tr from-purple-400 via-[#2bb3d3] to-[#0aaa9d] opacity-30 sm:left-[calc(50%-40rem)] sm:w-[72.1875rem] bg-[length:300%_auto] animate-blobs" style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)"></div>
        </div>

        <div x-data="cardsInteractions('{{active_tab}}', {{people}}, {{columns_json}}, '{{key_column}}')" id="card-grid" class="w-4/5 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 justify-center print:w-full print:portrait:!grid-cols-3">
            <div class="col-span-full" id="card-header">
                {% include 'components/_workers_topbar.html' %}
            </div>

            <div x-cloak x-show="addingCard" x-data="createCard(fields)" id="card-creation-form" class="flex flex-col w-full bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700 items-center">
                <div class="w-full flex px-4 pt-4 justify-end">
                    <p class="text-gray-500 dark:text-gray-400">Creating...</p>
                </div>
                <div class="w-full flex flex-col items-center px-10 pb-10" >
                    <img class="w-24 h-24 mb-3 rounded-full shadow-lg" src="https://i.ibb.co/f93t1mB/user.png" alt="person image"/>
                    <div class="w-full">
                        <ul class="mt-3 h-40 overflow-y-scroll divide-y bg-white py-2 px-3 text-gray-600
                        hover:text-gray-700 dark:bg-gray-800 dark:divide-gray-500 dark:text-gray-200 
                        custom-scrollbar"
                        :class="{'h-64' : activeTab == 'workers'}">

                            <template x-for="fieldObject in fields" :key="Object.keys(fieldObject)[0]">
                                <template x-if="!['editing', 'showDropdown'].includes(Object.keys(fieldObject)[0])">
                                    <li class="flex items-center py-3 text-sm">
                                        <span x-text="Object.keys(fieldObject)[0] + ':'" class="font-bold"></span>
                                        <template x-if="rawColumns[Object.keys(fieldObject)[0]] === 'PK'">
                                            <span x-text="Object.keys(fieldObject)[0] + ' is autogenerated'" class="ml-auto text-gray-500 dark:text-gray-400"></span>
                                        </template>
                                        <template x-if="rawColumns[Object.keys(fieldObject)[0]] !== 'PK' && !Object.keys(fieldObject)[0].toLowerCase().includes('date')">
                                            <input type="text" 
                                            :id="Object.keys(fieldObject)[0]" 
                                            class="ml-auto w-1/2 bg-gray-50 border border-gray-300 
                                            text-gray-900 text-sm rounded-lg focus:ring-blue-500 
                                            focus:border-blue-500 block p-2.5 dark:bg-gray-700 
                                            dark:border-gray-600 dark:placeholder-gray-400 
                                            dark:text-white dark:focus:ring-cyan-500 
                                            dark:focus:border-cyan-500" :placeholder="Object.keys(fieldObject)[0]"/>
                                        </template>
                                        <template x-if="rawColumns[Object.keys(fieldObject)[0]] === 'ATTRIB' && Object.keys(fieldObject)[0].toLowerCase().includes('date')">
                                            <div class="ml-auto w-1/2 relative max-w-sm">
                                                <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                                                    <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                                        <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                                                    </svg>
                                                </div>
                                                <input datepicker datepicker-autohide type="text"
                                                :id="Object.keys(fieldObject)[0]"
                                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg
                                                focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5  dark:bg-gray-700
                                                dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500
                                                dark:focus:border-blue-500" placeholder="Select date" />
                                            </div>
                                        </template>
                                    </li>
                                </template>
                            </template>
                        </ul>
                    </div>
                </div>
                <div class="w-2/3 flex px-4 pb-4 justify-between">
                    <button @click="cancelCreatingCard()"
                    class="text-gray-900 gap-2 px-5 py-2.5 me-2 mb-4 focus:outline-none bg-white font-medium  rounded-lg text-sm border
                    border-gray-200 hover:bg-gray-100 hover:text-cyan-700 focus:z-10 focus:ring-4 focus:ring-gray-100 
                    dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white
                    dark:hover:bg-gray-700">
                        Cancel
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                    <button @click="saveCreatedCard()"
                    class="text-white gap-2 bg-cyan-600 hover:bg-sky-600 
                    focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm 
                    px-5 py-2.5 me-2 mb-4 dark:bg-cyan-800 dark:hover:bg-cyan-900 
                    focus:outline-none dark:focus:ring-cyan-950">
                        Save
                        <i class="fa-solid fa-check"></i>
                    </button>
                </div>
            </div>


            <template x-for="card in $store.workersState.people" :key="card[key_column]">
                <div class="flex flex-col w-full bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700 items-center">
                    <div class="w-full flex px-4 pt-4 justify-end">
                        <!-- Dropdown button -->
                        <div class="relative" x-cloak x-show="!card.editing">
                            <button @click="card.showDropdown = !card.showDropdown" 
                                    class="inline-block text-gray-500 dark:text-gray-400 
                                    hover:bg-gray-100 dark:hover:bg-gray-700 focus:ring-4 
                                    focus:outline-none focus:ring-gray-200 dark:focus:ring-gray-700 
                                    rounded-lg text-sm p-1.5" 
                                    type="button">
                                <span class="sr-only">Open dropdown</span>
                                <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 3">
                                    <path d="M2 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm6.041 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM14 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z"/>
                                </svg>
                            </button>
                            <!-- Dropdown menu -->
                            <div x-show="card.showDropdown" @click.away="card.showDropdown = false" class="absolute mt-2 z-10 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700">
                                <ul class="py-2">
                                    <li><a href="javascript:void(0);" @click="$store.workersState.editCard(card[key_column], true)" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Edit</a></li>
                                    <li><a href="javascript:void(0);" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Export Data</a></li>
                                    <li><a href="javascript:void(0);" @click="$store.workersState.deleteCard(card[key_column])" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Delete</a></li>
                                </ul>
                            </div>
                        </div>
                        <div x-cloak x-show="card.editing">
                            <p class="text-gray-500 dark:text-gray-400">Editing...</p>
                        </div>
                    </div>
                    <!-- Person details -->
                    <div class="w-full flex flex-col items-center px-10 pb-10" :data-key="card[key_column]">
                        <img class="w-24 h-24 mb-3 rounded-full shadow-lg" src="https://i.ibb.co/f93t1mB/user.png" alt="person image"/>
                        <div x-cloak x-show="!card.editing" class="w-full text-center">
                            <h5 class="my-2 mb-4 text-xl font-medium text-gray-900 dark:text-white" x-text="`${card.Name} ${card.Patronymic} ${card.Surname}`"></h5>
                            <template x-for="[key, value] in Object.entries(card)" :key="key">
                                <div x-show="!['Name', 'Surname', 'Patronymic', 'editing', 'showDropdown'].includes(key)" class="mt-2 flex items-center w-full my-0.5 text-base text-gray-500 dark:text-gray-400">
                                    <span class="font-bold dark:text-gray-300" x-text="key + ':'"></span>
                                    <span class="mx-2 flex-1 dotted-line"></span>
                                    <span class="text-scramble" x-text="value" :data-key="key"></span>
                                </div>
                            </template>
                        </div>
                        <div x-cloak x-show="card.editing" class="w-full">
                            <ul class="mt-3 h-40 overflow-y-scroll divide-y bg-white py-2 px-3 text-gray-600 
                            hover:text-gray-700 dark:bg-gray-800 dark:divide-gray-500 dark:text-gray-200 
                            custom-scrollbar"
                            :class="{'h-64' : activeTab == 'workers'}">
                                <template x-for="[key, value] in Object.entries(card)" :key="key">
                                    <template x-if="!['editing', 'showDropdown'].includes(key)">
                                        <li class="flex items-center py-3 text-sm">
                                            <span x-text="key + ':'" class="font-bold"></span>
                                            <template x-if="rawColumns[key] === 'PK'">
                                                <span x-text="key + ' is autogenerated'" class="ml-auto text-gray-500 dark:text-gray-400"></span>
                                            </template>
                                            <template x-if="rawColumns[key] !== 'PK' && !key.toLowerCase().includes('date')">

                                                <input type="text" 
                                                :id="`${card[key_column]}-${key}-input`" 
                                                class="ml-auto w-1/2 bg-gray-50 border border-gray-300 
                                                text-gray-900 text-sm rounded-lg focus:ring-blue-500 
                                                focus:border-blue-500 block p-2.5 dark:bg-gray-700 
                                                dark:border-gray-600 dark:placeholder-gray-400 
                                                dark:text-white dark:focus:ring-cyan-500 
                                                dark:focus:border-cyan-500" :value="value" />

                                            </template>
                                            <template x-if="rawColumns[key] === 'ATTRIB' && key.toLowerCase().includes('date')">
                                                
                                                <div class="ml-auto w-1/2 relative max-w-sm">
                                                    <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                                                    <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                                        <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                                                        </svg>
                                                    </div>
                                                    <input datepicker datepicker-autohide type="text" 
                                                    :id="`${card[key_column]}-${key}-input`"
                                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg 
                                                    focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5  dark:bg-gray-700 
                                                    dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 
                                                    dark:focus:border-blue-500" placeholder="Select date" :value="$store.workersState.reformatDate(value)">
                                                </div>
  
                                            </template>
                                        </li>
                                    </template>
                                </template>
                            </ul>
                        </div>
                    </div>
                    <div class="w-2/3 flex px-4 pb-4 justify-between" x-cloak x-show="card.editing">
                        <button @click="$store.workersState.cancelEditingCard(card[key_column])"
                        class="text-gray-900 gap-2 px-5 py-2.5 me-2 mb-4 focus:outline-none bg-white font-medium  rounded-lg text-sm border
                        border-gray-200 hover:bg-gray-100 hover:text-cyan-700 focus:z-10 focus:ring-4 focus:ring-gray-100 
                        dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white
                        dark:hover:bg-gray-700">
                            Cancel
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                        <button @click="$store.workersState.saveEditedCard(card[key_column])"
                        class="text-white gap-2 bg-cyan-600 hover:bg-sky-600 
                        focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm 
                        px-5 py-2.5 me-2 mb-4 dark:bg-cyan-800 dark:hover:bg-cyan-900 
                        focus:outline-none dark:focus:ring-cyan-950">
                            Save
                            <i class="fa-solid fa-check"></i>
                        </button>
                    </div>
                </div>
            </template>
            
        </div>

        <div class="fixed inset-x-0 bottom-0 -z-10 transform-gpu overflow-hidden blur-3xl " aria-hidden="true">
            <div class="relative left-[calc(50%+3rem)] aspect-[1155/678] w-[36.125rem] -translate-x-1/2 bg-gradient-to-tr from-purple-400 via-[#2bb3d3] to-[#0aaa9d] opacity-30 sm:left-[calc(50%+36rem)] sm:w-[72.1875rem] bg-[length:300%_auto] animate-blobs" style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)"></div>
        </div>
    </div>

</div>
{% endblock %}
